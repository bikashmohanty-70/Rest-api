package com.bridgelabz.userapis.loginregistration.database;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.ArrayList;
import java.util.List;

import com.bridgelabz.userapis.loginregistration.model.Users;
import com.google.gson.JsonArray;
import com.google.gson.JsonObject;

/**
 * 
 * @author Bikash Mohanty
 * @since 25Th Jan 2020
 * @version 1.0
 * 
 * Purpose: 
 *
 */
public class DAOImplementation implements IUserDao 
{
	Users usersBean = new Users();
	static Connection connection = DatabaseConnectivity.getConnection(); 
	static PreparedStatement preparedStatement = null;
	Statement statement = null;
	ResultSet resultSet = null;
	
	@Override
	public boolean insertIntoUserApiTable(Users usersBean)
	{
		String insertQuery = "INSERT INTO users_api (firstname, lastname, username, password, email, city, state, zip) VALUES (?, ?, ?, ?, ?, ?, ?, ?)";
		try(PreparedStatement preparedStatement = connection.prepareStatement(insertQuery)) 
		{
			System.out.println("Connection "+connection);
			preparedStatement.setString(1, usersBean.getFirstname());
			preparedStatement.setString(2, usersBean.getLastname());
			preparedStatement.setString(3, usersBean.getUsername());
			preparedStatement.setString(4, usersBean.getPassword());
			preparedStatement.setString(5, usersBean.getEmail());
			preparedStatement.setString(6, usersBean.getCity());
			preparedStatement.setString(7, usersBean.getState());
			preparedStatement.setString(8, usersBean.getZip());
			
			if(preparedStatement.executeUpdate() > 0)
				return true;
			
		} 
		catch (SQLException e) 
		{
			e.printStackTrace();
		}
		
		
		return false;
	}
	
	@Override
	public boolean updateUserApiTable()
	{
		return false;
	}
	
	@Override
	public boolean deleteRecordsInUserApiTable()
	{
		return false;
	}

	@Override
	public JsonArray getAll() {
		

		String userList = "select * from users_api";
		try(PreparedStatement preparedStatement = connection.prepareStatement(userList))
		{
			resultSet = preparedStatement.executeQuery();
			while (resultSet.next()) 
			{		
				JsonObject usersData = new JsonObject();
				
				user.setFirstname(resultSet.getString(2));
				user.setLastname(resultSet.getString(3));
				user.setUsername(resultSet.getString(4));
				user.setEmail(resultSet.getString(8));
				user.setPassword(resultSet.getString(9));
				user.setCity(resultSet.getString(5));
				user.setState(resultSet.getString(6));
				user.setZip(resultSet.getString(7));
				
				list.add(user);	
			}
			return list;
		}
		catch (SQLException e) 
		{
			e.printStackTrace();
		}
		return null;
	}
	
	
	
}
